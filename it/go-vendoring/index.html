<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Vendoring зависимостей в Go | Alexander Bulimov: Production Engineer and Scale Modeller</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="https://models.bulimov.me">Scale Models</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/reviews/">Reviews</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Vendoring зависимостей в Go</span></h1>

<h2 class="date">2016/03/31</h2>

</div>

<main>
<p>После недавнего <a href="http://www.opennet.ru/opennews/art.shtml?num=44104">удаления модуля на 11 строк кода из npm</a>,
которое сломало всю Node.js инфраструктуру, я по-новому взглянул на то,
как в проектах на Go реализованы зависимости от других пакетов.</p>
<p>Изначально, при знакомстве с go я был крайне недоволен отсутствием возможности задавать зависимости
от конкретных версий (зависимость указывается только от репозитория, т.е. от master ветки) -
ведь апстрим может ломать обратную совместимость, и твой проект просто не соберется.
Причем я сам с этой проблемой столкнулся, и это было очень неприятно.</p>
<p>К счастью, не я один страдал от этой недоработки, и для решения этой проблемы в go1.5 добавили
<a href="https://docs.google.com/document/d/1Bz5-UB7g2uPBdOx-rw5t9MxJwkfpx90cqG9AFL0JAYo">экспериментальный vendoring зависимостей</a>,
который в 1.6 включили по-умолчанию.</p>
<p>Теперь появилась возможность сложить все зависимости в директорию <code>vendor/</code>
внутри своего проекта, и все утилиты go будут с ними корректно работать.</p>
<p>Тут возникла дилемма - добавлять ли <code>vendor/</code> в git вместе с проектом?</p>
<p><a href="http://glide.sh">Glide</a>, популярная утилита для работы с зависимостями в go,
которой я пользуюсь, дает <a href="https://glide.readthedocs.org/en/latest/vendor/#recommendations">следующие рекомендации</a>:</p>
<ul>
<li>для библиотек не добавлять <code>vendor/</code> в VCS;</li>
<li>для утилит добавлять <code>vendor/</code> в VCS для обеспечения повторяемости билдов у пользователей.</li>
</ul>
<p>Мысль о добавлении всех зависимостей в репозиторий моего проекта пугала меня,
и казалась костылем. Однако после анализа своего опыта взаимодействия с менеджерами пакетов
в других языках и по здравому размышлению о подходе go, я был вынужден принять
решение с добавлением всех зависимостей в проект.</p>
<p>Решение это не идеальное, но создание очередного навороченного менеджера пакетов
тоже не подарок, и проблем (как мы видим на примере того-же Python) с ним хватает.</p>
<p>А тут мы застрахованы и от удаления самого репозитория с нашей зависимостью,
и от поломанной обратной совместимости. Кстати, насколько мне известно, все большие
проекты работают именно по такой схеме - хранят все зависимости у себя.</p>
<p>При этом радует то, что для установки утилит с зависимостями в <code>vendor/</code> в VCS
не нужен никакой менеджер зависимостей типа Glide/Godeps и т.п. - мухи отдельно,
котлеты отдельно. Пользователь просто делает <code>go get my_package</code> и радуется.
А мы используем менеджер зависимостей по вкусу и тоже радуемся - все довольны.</p>
<p>В общем, на этом примере явно видна одна из главных особенностей Go, то, за что его можно
одновременно любить и ненавидеть - он прагматичный до мозга костей.</p>
<p>Лично для меня это скорее достоинство.</p>

</main>


<p class="terms">
<b>Tags:</b>

  <a href="//bulimov.me/tags/golang/">Golang</a>

  <a href="//bulimov.me/tags/%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/">Программирование</a>


</p>
<p class="terms">

<b>Categories:</b>

  <a href="//bulimov.me/categories/it/">IT</a>

  <a href="//bulimov.me/categories/russian/">Russian</a>


</p>

  <footer>
  
  
  <hr/>
  <a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" alt="License: CC BY-SA 4.0"></a> © <a href="http://bulimov.me">Alexander Bulimov</a> 2013 &ndash; 2024 | <a href="https://github.com/abulimov">Github</a>
  
  </footer>
  </body>
</html>

