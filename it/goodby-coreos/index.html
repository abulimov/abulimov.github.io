<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Избавился от CoreOS | Alexander Bulimov: Production Engineer and Scale Modeller</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="https://models.bulimov.ru">Scale Models</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Избавился от CoreOS</span></h1>

<h2 class="date">2015/10/26</h2>

</div>

<main>
<p>С огромным облегчением сегодня убрал последний хост с <a href="http://coreos.com">CoreOS</a>.</p>
<p>Я уже <a href="/it/coreos-opinion/">писал</a> о своих впечатлениях от CoreoOS, но с тех пор
впечатлений прибавилось.</p>
<p>Частые атомарные обновления на бумаге выглядели вкусно (и в пользовательских
ОС типа Android работают прекрасно), но вот на практике на серверах
в том виде, в котором CoreOS их готовит, оказались совсем несъедобны.</p>
<p>Объясню, в чем проблема: Docker достаточно часто что-то ломает в API, и свежие
ядра Linux ломают всякие важные вещи тоже довольно часто, причем зачастую даже
в рамках patch-level обновлений. Например, работа с libpthread ломалась с ядра 3.19
(причем этот баг бекпорировали в Ubuntu 3.13.48 LTS, что добавило радости)
и до 4.0, а потом с 4.1 до 4.2.
Почитать про это можно например <a href="https://bugzilla.xamarin.com/show_bug.cgi?id=29212">тут</a>,
хотя проблема затронула далеко не только Mono.</p>
<p>Короче, любой апдейт ОС надо хорошенько протестировать на стендах, и потом только
обновлять прод.</p>
<p>А в случае CoreOS мы не можем контролировать, на какую версию
обновляться. Обновляемся всегда на последнюю имеющуюся на их серверах версию,
а она может уйти вперед за время обкатки на стендах.</p>
<p>Более того, чтобы откатиться на прошлую версию, в CoreOS нужно
<a href="https://coreos.com/os/docs/latest/manual-rollbacks.html">использовать волшебную конструкцию</a>
такого вида:</p>
<pre><code>cgpt prioritize &quot;$(cgpt find -t coreos-usr | grep --invert-match &quot;$(findmnt --noheadings --raw --output=source --target=/usr)&quot;)&quot;
</code></pre><p>При этом нет возможности узнать, на какую версию будет сделан откат.</p>
<p>CoreOS конечно молодцы, и в <a href="https://coreos.com/products/">платной версии</a> предлагают
удобный дашборд для контроля выкатки конкретной версии на конкретную группу хостов.
Но для обычных людей подобные радости недоступны.</p>
<p>В общем, на практике оказалось, что каждое обновление CoreOS это лишняя трата нервов,
и любой вменяемый дистрибутив в минимальном виде и с оркестрацией через Ansible
в разы удобнее, и главное предсказуемее. Ну вышло кривое ядро - увидел это на
тестовых стендах, откатил пакет назад, и жди новую версию, где баг починили.
При этом нет никакой проблемы обновить конкретный компонент с уязвимостью или багом.</p>
<p>А после работы с CoreOS я могу точно сказать, что пока не будет возможности
полностью контролировать процесс обновления ОС (а лучше возможности самому собрать
&ldquo;апдейт&rdquo;), я не готов даже рассматривать подобные дистрибутивы.</p>

</main>


<p class="terms">
<b>Tags:</b>

  <a href="//bulimov.ru/tags/coreos/">CoreOS</a>

  <a href="//bulimov.ru/tags/%D0%BC%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5/">Мнение</a>

  <a href="//bulimov.ru/tags/%D0%BE%D0%BF%D1%8B%D1%82/">Опыт</a>


</p>
<p class="terms">

<b>Categories:</b>

  <a href="//bulimov.ru/categories/it/">IT</a>

  <a href="//bulimov.ru/categories/russian/">Russian</a>


</p>

  <footer>
  
  
  <hr/>
  <a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" alt="License: CC BY-SA 4.0"></a> © <a href="http://bulimov.ru">Alexander Bulimov</a> 2013 &ndash; 2021 | <a href="https://github.com/abulimov">Github</a>
  
  </footer>
  </body>
</html>

